# Complete Working Example

This is a complete, working example demonstrating the Najlot.Map.SourceGenerator in action.

## Project Setup

```bash
# Create a new console application
dotnet new console -n MapGeneratorDemo
cd MapGeneratorDemo

# Add the source generator package
dotnet add package Najlot.Map.SourceGenerator
```

## Models.cs

```csharp
using Najlot.Map.SourceGenerator;

namespace MapGeneratorDemo;

// Domain entity with [Mapping] attribute
[Mapping]
public partial class User
{
    public Guid Id { get; set; }
    public string Username { get; set; } = string.Empty;
    public string Email { get; set; } = string.Empty;
    public DateTime CreatedAt { get; set; }
    public bool IsActive { get; set; }
}

// DTO for API responses
public class UserDto
{
    public Guid Id { get; set; }
    public string Username { get; set; } = string.Empty;
    public string Email { get; set; } = string.Empty;
    public DateTime CreatedAt { get; set; }
    public bool IsActive { get; set; }
}

// Request model for creating users
public class CreateUserRequest
{
    public string Username { get; set; } = string.Empty;
    public string Email { get; set; } = string.Empty;
}
```

## Mappers.cs

```csharp
using Najlot.Map.SourceGenerator;

namespace MapGeneratorDemo;

// Mapper class with partial methods
public partial class UserMapper
{
    [Mapping]
    public partial UserDto MapToDto(User user);
    
    [Mapping]
    public partial User MapFromRequest(CreateUserRequest request);
}
```

## Program.cs

```csharp
using MapGeneratorDemo;

var mapper = new UserMapper();

// Example 1: Create a user from request
Console.WriteLine("=== Example 1: Mapping from CreateUserRequest ===");
var request = new CreateUserRequest
{
    Username = "johndoe",
    Email = "john@example.com"
};

var user = mapper.MapFromRequest(request);
user.Id = Guid.NewGuid();
user.CreatedAt = DateTime.UtcNow;
user.IsActive = true;

Console.WriteLine($"Created User: {user.Username} ({user.Email})");
Console.WriteLine($"  ID: {user.Id}");
Console.WriteLine($"  Created: {user.CreatedAt}");
Console.WriteLine($"  Active: {user.IsActive}");

// Example 2: Convert to DTO
Console.WriteLine("\n=== Example 2: Mapping to UserDto ===");
var dto = mapper.MapToDto(user);
Console.WriteLine($"DTO: {dto.Username} ({dto.Email})");
Console.WriteLine($"  ID: {dto.Id}");
Console.WriteLine($"  Created: {dto.CreatedAt}");
Console.WriteLine($"  Active: {dto.IsActive}");

// Example 3: Clone a user using MapFrom
Console.WriteLine("\n=== Example 3: Cloning with MapFrom ===");
var clonedUser = new User();
clonedUser.MapFrom(user);
clonedUser.Id = Guid.NewGuid(); // Give it a new ID

Console.WriteLine($"Cloned User: {clonedUser.Username} ({clonedUser.Email})");
Console.WriteLine($"  Original ID: {user.Id}");
Console.WriteLine($"  Cloned ID: {clonedUser.Id}");

// Example 4: Demonstrating performance
Console.WriteLine("\n=== Example 4: Performance Test ===");
var sw = System.Diagnostics.Stopwatch.StartNew();
for (int i = 0; i < 1_000_000; i++)
{
    var tempDto = mapper.MapToDto(user);
}
sw.Stop();
Console.WriteLine($"Mapped 1,000,000 objects in {sw.ElapsedMilliseconds}ms");
Console.WriteLine($"Average: {sw.ElapsedMilliseconds / 1_000_000.0}ms per mapping");
```

## Generated Code

The source generator will create these files during compilation:

### User_Generated.g.cs
```csharp
// <auto-generated/>
#nullable enable

namespace MapGeneratorDemo
{
    partial class User
    {
        /// <summary>
        /// Maps properties from another instance of User.
        /// </summary>
        public void MapFrom(User source)
        {
            if (source == null)
            {
                throw new System.ArgumentNullException(nameof(source));
            }

            this.Id = source.Id;
            this.Username = source.Username;
            this.Email = source.Email;
            this.CreatedAt = source.CreatedAt;
            this.IsActive = source.IsActive;
        }
    }
}
```

### UserMapper_MapToDto.g.cs
```csharp
// <auto-generated/>
#nullable enable

namespace MapGeneratorDemo
{
    partial class UserMapper
    {
        public partial UserDto MapToDto(User user)
        {
            var result = new UserDto();

            result.Id = user.Id;
            result.Username = user.Username;
            result.Email = user.Email;
            result.CreatedAt = user.CreatedAt;
            result.IsActive = user.IsActive;

            return result;
        }
    }
}
```

### UserMapper_MapFromRequest.g.cs
```csharp
// <auto-generated/>
#nullable enable

namespace MapGeneratorDemo
{
    partial class UserMapper
    {
        public partial User MapFromRequest(CreateUserRequest request)
        {
            var result = new User();

            result.Username = request.Username;
            result.Email = request.Email;

            return result;
        }
    }
}
```

## Expected Output

```
=== Example 1: Mapping from CreateUserRequest ===
Created User: johndoe (john@example.com)
  ID: 12345678-1234-1234-1234-123456789abc
  Created: 12/13/2025 6:00:00 PM
  Active: True

=== Example 2: Mapping to UserDto ===
DTO: johndoe (john@example.com)
  ID: 12345678-1234-1234-1234-123456789abc
  Created: 12/13/2025 6:00:00 PM
  Active: True

=== Example 3: Cloning with MapFrom ===
Cloned User: johndoe (john@example.com)
  Original ID: 12345678-1234-1234-1234-123456789abc
  Cloned ID: 87654321-4321-4321-4321-cba987654321

=== Example 4: Performance Test ===
Mapped 1,000,000 objects in 25ms
Average: 0.000025ms per mapping
```

## Key Takeaways

1. **Zero Configuration**: Just add `[Mapping]` attribute
2. **Type Safety**: All code is generated and type-checked at compile time
3. **Performance**: No reflection, no runtime overhead
4. **Debuggable**: Step into generated code just like handwritten code
5. **Transparent**: Generated files visible in obj/GeneratedFiles folder
6. **Incremental**: Fast compilation with intelligent caching

## Viewing Generated Files

Generated files are located at:
```
obj/Debug/net8.0/GeneratedFiles/Najlot.Map.SourceGenerator/Najlot.Map.SourceGenerator.MappingGenerator/
```

Enable this in your .csproj to see generated files in IDE:
```xml
<PropertyGroup>
  <EmitCompilerGeneratedFiles>true</EmitCompilerGeneratedFiles>
  <CompilerGeneratedFilesOutputPath>$(BaseIntermediateOutputPath)\GeneratedFiles</CompilerGeneratedFilesOutputPath>
</PropertyGroup>
```
